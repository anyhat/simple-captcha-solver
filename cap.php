<?
	function get_info($img_res, $first, $second){ $data='';
		for($x=$first; $x<=$second; $x++){
			for($y=8; $y<=32; $y++){
			    $rgb = imagecolorat($img_res, $x, $y);
			    $r = ($rgb >> 16) & 0xFF;
			    $g = ($rgb >> 8 ) & 0xFF;
			    $b = $rgb & 0xFF;
			    $gray = $r + $g + $b/3;
			    if ($gray >0xFF) {$data .= '0';} // белый
			    else {$data .= '1';} // чи чорный
			}
		}
		return $data; // получаем "маску" цифры
	}
	
	// готовые маски

	$arr[0] = '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111000000000000111111111111100000000000011000000001110000000000001100000000111000000000000110000000011100000000000011000000001110000000000001100000000111000000000000110000000011100000000000011000000001110000000000001100000000111000000000000111111111111100000000000011111111111110000000000001111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
	$arr[1] = '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111110000000000001111111111111000000000000111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
	$arr[2] = '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100011111111000000000000110001111111100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011111111000110000000000001111111100011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
	$arr[3] = '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100011100011000000000000110001110001100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011111111111110000000000001111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
	$arr[4] = '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000001111111100000000000000000111111110000000000000000000000111000000000000000000000011100000000000000000000001110000000000000000000000111000000000000000000000011100000000000000000000001110000000000000000000000111000000000000000000000011100000000000000000111111111111100000000000011111111111110000000000001111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
	$arr[5] = '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111100011000000000000111111110001100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011000111111110000000000001100011111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
	$arr[6] = '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000001111111111111000000000000111111111111100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011000111000110000000000001100011100011000000000000110001111111100000000000011000111111110000000000001100011111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
	$arr[7] = '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000001000000000000110000000001100000000000011000000011110000000000001100000011111000000000000110000111111000000000000011000111110000000000000001101111110000000000000000111111110000000000000000011111100000000000000000001111100000000000000000000111000000000000000000000011000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
	$arr[8] = '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111000000000000111111111111100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011000111000110000000000001100011100011000000000000111111111111100000000000011111111111110000000000001111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
	$arr[9] = '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000001111111100011000000000000111111110001100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011000111000110000000000001100011100011000000000000110001110001100000000000011000111000110000000000001100011100011000000000000111111111111100000000000011111111111110000000000001111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';

		echo '<img src="cap.jpg?'.rand(1,100000).'"></br>';
		$img_res = imagecreatefromjpeg('cap.jpg');
		
		function get_num($info, $arr){
			$sim = 0;
			for($i=0; $i<=9; $i++){
				$comp_sim = similar_text($info, $arr[$i]); // степень похожести
				if($comp_sim > $sim){$sim = $comp_sim; $num = $i;} // выбираем самую похожую маску			
			}
			return $num; // получаем цифру
		}
		
		echo get_num(get_info($img_res, 0, 24), $arr); // координаты границы цыфр
		echo get_num(get_info($img_res, 27, 51), $arr);
		echo get_num(get_info($img_res, 55, 79), $arr);
    		// на 100% решает верно (при том что цыфры капельку отличаются после отрисовки) 
?>
